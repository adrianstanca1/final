name : CI / CD Pipelinename : CI / CD Pipeline

                                       on : on : push : branches : [ main, develop ] pull_request : branches : [ main, develop ]

                                                                                                               push :

    branches : [ main, develop ] env : NODE_VERSION : '20' POSTGRES_VERSION : '15'

                                                                              pull_request :

    branches : [ main, develop ] jobs :

#Test Jobs

    env : test -

        NODE_VERSION : '20' frontend : name : Test Frontend

                                                  POSTGRES_VERSION : '15' runs -

                                                                     on : ubuntu - latest

                                                                                       jobs :

#Test Jobs steps : -name : Checkout code uses : actions /

    test -
    frontend : checkout @v4

                   name : Test Frontend

                              runs -
                          on : ubuntu - latest -

                               name : Setup Node.js

                                          steps : uses : actions /

                                   -name : Checkout code setup -

                               uses : actions / checkout @v4 node @v4

                                                    with : node -

                               -name : Setup Node.js version : $

                                                                   uses : actions /
                                   setup -
                               node @v4{

                                   with : {

                                       node - version : ${{env.NODE_VERSION}} env.NODE_VERSION

                                              cache : 'npm'
                                   }

                               }

                               -
                               name : Install dependenciescache : 'npm'

                                                                  run : npm ci

                                                                        -

                                                                        -name : Run linting name : Install dependencies

                                                                                                       run : npm run lint ||
    true run : npm ci

               -
               name : Run type checking -

                      run : npm run type - check ||
    true name : Run linting

                    run : npm run lint ||

                          -name : Run frontend tests true

                                  run : npm run test

                              - name : Run type checking

                                       -
                                       name : Generate test coverage run : npm run type -

                                                                           run : npm run test : coverage check ||

                          true

                                  test -
                                  backend :

    name : Test Backend -
           name : Run frontend tests

                      runs -
                  on : ubuntu - latest run : npm run test

                                                 services : -

                                                            postgres : name : Generate test coverage

                                                                                  image : postgres : 15 run : npm run test : coverage

                                                                                                                                 env :

    POSTGRES_PASSWORD : test_password test -

                        POSTGRES_USER : test_user backend : name : Test Backend

                                                                       POSTGRES_DB : test_db runs -

                                                                                     options : >
                                                                                               -on : ubuntu - latest

                                                                                                   -- health -
                                                                                                   cmd pg_isready

                                                                                                   -- health -
                                                                                                   interval 10s services : postgres : image : postgres : 15 env : POSTGRES_PASSWORD : test_password POSTGRES_USER : test_user POSTGRES_DB : test_db options : >

                                                                                                                                                                                                                                                              --health - timeout 5s - --health - cmd pg_isready-- health - interval 10s --health - timeout 5s --health - retries 5 ports : -5432 : 5432

                                                                                                                                                                                                                                                                                                                                                                                           --health -
                                                                                                                                                                                                                                                                                                                                                                                           retries 5

                                                                                                                                                                                                                                                                                                                                                                                           ports : redis : image : redis : 7 -

                                                                                                                                                                                                                                                                                                                                                                                                                   -5432 : 5432 alpine

                                                                                                                                                                                                                                                                                                                                                                                                                       options : >

                                                                                                                                                                                                                                                                                                                                                                                                                                 redis : - --health - cmd "redis-cli ping" --health - interval 10s --health - timeout 5s --health - retries 5 ports : -6379 : 6379

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      image : redis : 7 -
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              alpine

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  options : >
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            -steps : -name : Checkout code uses : actions /

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    --health -
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmd "redis-cli ping" checkout @v4

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -- health -
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                interval 10s

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                --health -
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                timeout 5s - name : Setup Node.js

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    -- health -
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                retries 5 uses : actions /

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ports : setup -

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -6379 : 6379 node @v4

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    with : node -

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                steps : version : $

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  name : Checkout code
{

uses:
    actions / checkout @v4{

        env.NODE_VERSION

        - name : Setup Node.js
    }

            uses : actions /
                   setup -
        node @v4
}

with : cache : 'npm' cache - dependency - path : 'backend/package-lock.json'

                                                 node -
                                                 version : $
{
    {
        env.NODE_VERSION
    }
}

cache : 'npm' -

        cache - dependency - path : 'backend/package-lock.json' name : Install backend dependencies

                                                                           run : |

                                                                                 -name : Install backend dependencies cd backend

                                                                                             run : |
                                                                                                   npm ci

                                                                                                           cd backend

                                                                                                               npm ci -
                                                                                                       name : Generate Prisma client

                                                                                                                  run : |

                                                                                                                        -name : Generate Prisma client cd backend

                                                                                                                                    run : |
                                                                                                                                          npx prisma generate

                                                                                                                                                  cd backend

                                                                                                                                                      npx prisma generate -
                                                                                                                                              name : Run database migrations

                                                                                                                                                         run : |

                                                                                                                                                               -name : Run database migrations cd backend

                                                                                                                                                                           run : |
                                                                                                                                                                                 npx prisma migrate deploy

                                                                                                                                                                                         cd backend env : DATABASE_URL : postgresql : // test_user:test_password@localhost:5432/test_db

                                                                                                                                                                                                                                      npx prisma migrate deploy

                                                                                                                                                                                                                                          env : -name : Run backend linting

                                                                                                                                                                                                                                                            DATABASE_URL : postgresql : // test_user:test_password@localhost:5432/test_db                                                                                                                                                               run : |

                                                                                                                                                                                                                                                                                        cd backend

                                                                                                                                                                                                                                                                                        -
                                                                                                                                                                                                                                                                                        name : Run backend linting npm run lint ||

    run : | true

          cd backend

              npm run lint ||
    true - name : Run backend type checking

                      run : |

                            -name : Run backend type checking cd backend

                                        run : |
                                              npm run type -

                                                  cd backend check ||

    npm run type - check || true true

                                    - name : Run backend tests - name : Run backend tests

                                                                            run : |
                                                                                  run : |

                                                                                        cd backend cd backend

                                                                                                npm run test npm run test

                                                                                                    env : env : DATABASE_URL : postgresql : // test_user:test_password@localhost:5432/test_db

                                                                                                                                            DATABASE_URL : postgresql : // test_user:test_password@localhost:5432/test_db                                                                             REDIS_URL : redis : // localhost:6379

                                                                                                                                                                        REDIS_URL : redis : // localhost:6379                                                                                                 JWT_SECRET : test_jwt_secret_key_for_testing

                                                                                                                                                                                            JWT_SECRET : test_jwt_secret_key_for_testing NODE_ENV : test

                                                                                                                                                                                                                                                        NODE_ENV : test

#Security Scanning Jobs

#Build Jobs security -

                                                                                                                                                                                                                                                                       build -
                                                                                                                                                                                                                                                                   frontend : frontend : name : Security Scan Frontend

                                                                                                                                                                                                                                                                                                    name : Build Frontend runs -

                                                                                                                                                                                                                                                                                                           runs - on : ubuntu - latest on : ubuntu - latest

                                                                                                                                                                                                                                                                                                                                                             needs : [test - frontend]

                                                                                                                                                                                                                                                                                                                                                                     steps : -name : Checkout code uses : actions /

                                                                                                                                                                                                                                                                                                                                                                                                          steps : checkout @v4

                                                                                                                                                                                                                                                                                                                                            -
                                                                                                                                                                                                                                                                                                                                            name : Checkout code

                                                                                                                                                                                                                                                                                                                                                       uses : actions /
                                                                                                                                                                                                                                                                                                                                                              checkout @v4 -

                                                                                                                                                                                                                                                                                                                                            name : Setup Node.js

                                                                                                                                                                                                                                                                                                                                            -
                                                                                                                                                                                                                                                                                                                                            name : Setup Node.js uses : actions /

                                                                                                                                                                                                                                                                                                                                                uses : actions / setup -
                                                                                                                                                                                                                                                                                                                                            node @v4 setup -

                                                                                                                                                                                                                                                                                                                                            with : node @v4

                                                                                                                                                                                                                                                                                                                                                       node -
                                                                                                                                                                                                                                                                                                                                                   version : $
{
    {
        env.NODE_VERSION
    }
}                                                                                                                                                        with : node -

          cache: 'npm'                                                                                                                                                               version : $

      {

      - name: Install dependencies    {

        run: npm ci        env.NODE_VERSION

          }

      - name: Build application}

        run: npm run build          cache: 'npm'

        env:      

          NODE_ENV: production      - name: Install dependencies

              run: npm ci

      - name: Upload build artifacts      

        uses: actions/upload-artifact@v4      - name: Run security audit

        with:        run: npm audit --audit-level=high

          name: frontend-build      

          path: dist/      - name: Check for known vulnerabilities

          retention-days: 7        run: npx audit-ci --moderate



  build-backend:  security-backend:

    name: Build Backend    name: Security Scan Backend

    runs-on: ubuntu-latest    runs-on: ubuntu-latest

    needs: [test-backend]    

        steps:

    steps:      - name: Checkout code

      - name: Checkout code        uses: actions/checkout@v4

        uses: actions/checkout@v4      

            - name: Setup Node.js

      - name: Setup Node.js        uses: actions/setup-node@v4

        uses: actions/setup-node@v4        with:

        with:          node-version: $

          node-version: ${{ env.NODE_VERSION }}          {

          cache: 'npm'              {

          cache-dependency-path: 'backend/package-lock.json'                  env.NODE_VERSION

                    }

      - name: Install backend dependencies          }

        run: |          cache : 'npm' cache - dependency - path : 'backend/package-lock.json'

          cd backend

          npm ci                                                    -

                                                          name : Install backend dependencies

      - name: Generate Prisma client                                                               run : |

        run: |                                                                     cd backend

          cd backend                                                                             npm ci

          npx prisma generate

                                                                               - name : Run backend security audit

      - name: Build backend                                                                                      run : |

        run: |                                                                                            cd backend

          cd backend                                                                                                    npm audit-- audit -

          npm run build                                                                                                level = high

        env:

          NODE_ENV: production                                                                                                            - name : Check backend vulnerabilities

                                                                                                                               run : |

      - name: Upload backend build artifacts                                                                                                                               cd backend

        uses: actions/upload-artifact@v4                                                                                                                                       npx audit -

        with:                                                                                                                                   ci-- moderate

          name: backend-build

          path: backend/dist/#Build Jobs

          retention-days: 7                                                                                                                                       build -
                                                                                                                                   frontend : name : Build Frontend
                                                                                                                                                         runs -
                                                                                                                                                     on : ubuntu - latest needs : [ test - frontend, security - frontend ]

                                                                                                                                                                                  steps : -name : Checkout code uses : actions /
                                                                                                                                                                                                                       checkout @v4

                                                                                                                                                          -
                                                                                                                                                          name : Setup Node.js
                                                                                                                                                                     uses : actions /
                                                                                                                                                              setup -
                                                                                                                                                          node @v4
                                                                                                                                                              with : node -
                                                                                                                                                                     version : $
{
    {
        env.NODE_VERSION
    }
}
cache : 'npm'

        -
        name : Install dependencies
                   run : npm ci

                         -
                         name : Build application
                                    run : npm run build
                                              env : NODE_ENV : production

                                                               -
                                                               name : Upload build artifacts
                                                                          uses : actions /
                                                                                 upload -
                                                               artifact @v4
                                                                   with : name : frontend -
                                                                                 build
                                                                                         path : dist /
                                                                                                retention -
                                                                                 days : 7

                                                                                 build -
                                                                                 backend : name : Build Backend
                                                                                                      runs -
                                                                                                  on : ubuntu - latest needs : [ test - backend, security - backend ]

                                                                                                                               steps : -name : Checkout code uses : actions /
                                                                                                                                                                    checkout @v4

                                                                                                       -
                                                                                                       name : Setup Node.js
                                                                                                                  uses : actions /
                                                                                                           setup -
                                                                                                       node @v4
                                                                                                           with : node -
                                                                                                                  version : $
{
    {
        env.NODE_VERSION
    }
}
cache : 'npm' cache - dependency - path : 'backend/package-lock.json'

                                          -
                                          name : Install backend dependencies
                                                     run : |
                                                           cd backend
                                                                   npm ci

                                                               - name : Generate Prisma client
                                                                            run : |
                                                                                  cd backend
                                                                                          npx prisma generate

                                                                                      - name : Build backend
                                                                                                   run : |
                                                                                                         cd backend
                                                                                                                     npm run build
                                                                                                                         env : NODE_ENV : production

                                                                                                                                          -
                                                                                                                                          name : Upload backend build artifacts
                                                                                                                                                     uses : actions /
                                                                                                                                                            upload -
                                                                                                                                          artifact @v4
                                                                                                                                              with : name : backend -
                                                                                                                                                            build
                                                                                                                                                                    path : backend /
                                                                                                                                                                           dist /
                                                                                                                                                                           retention -
                                                                                                                                                            days : 7

#Docker Build Jobs
                                                                                                                                                            build -
                                                                                                                                                            docker - frontend : name : Build Frontend Docker Image runs - on : ubuntu - latest needs : [build - frontend] if : github.ref ==
                                                                                                             'refs/heads/main' ||
    github.ref == 'refs/heads/develop'

                          steps : -name : Checkout code
                                              uses : actions /
                                                     checkout @v4

                      - name : Set up Docker Buildx
                                   uses : docker /
                                          setup -
                      buildx - action @v3

                      - name : Login to Docker Hub
                                   uses : docker /
                                          login -
                      action @v3
                          with : username : $
{
    {
        secrets.DOCKER_USERNAME
    }
}
password : ${{secrets.DOCKER_PASSWORD}}

           -
           name : Extract metadata
                      id : meta
                               uses : docker /
                                      metadata -
           action @v5
                   with : images : ${{secrets.DOCKER_USERNAME}} /
                                   construction -
           frontend
               tags : |
                      type = ref,
                      event = branch
                          type = sha,
                      prefix = {{branch}} -
                               type = raw,
                      value = latest, enable = {{is_default_branch}}

                                                   - name : Build and
                                               push Docker image uses : docker / build - push - action @v5 with : context :.file :./ Dockerfile.frontend push : true tags : $
{
    {
        steps.meta.outputs.tags
    }
}
labels : $
{
    {
        steps.meta.outputs.labels
    }
}
cache - from : type = gha
                          cache -
                      to : type = gha,
               mode = max

                                  build -
                              docker - backend : name : Build Backend Docker Image runs - on : ubuntu - latest needs : [build - backend] if : github.ref ==
                          'refs/heads/main' ||
                      github.ref == 'refs/heads/develop'

                                            steps : -name : Checkout code
                                                                uses : actions /
                                                                       checkout @v4

                                        - name : Set up Docker Buildx
                                                     uses : docker /
                                                            setup -
                                        buildx - action @v3

                                        - name : Login to Docker Hub
                                                     uses : docker /
                                                            login -
                                        action @v3
                                            with : username : $
{
    {
        secrets.DOCKER_USERNAME
    }
}
password : ${{secrets.DOCKER_PASSWORD}}

           -
           name : Extract metadata
                      id : meta
                               uses : docker /
                                      metadata -
           action @v5
                   with : images : ${{secrets.DOCKER_USERNAME}} /
                                   construction -
           backend
               tags : |
                      type = ref,
                      event = branch
                          type = sha,
                      prefix = {{branch}} -
                               type = raw,
                      value = latest, enable = {{is_default_branch}}

                                                   - name : Build and
                                               push Docker image uses : docker / build - push - action @v5 with : context :./ backend file :./ backend / Dockerfile push : true tags : $
{
    {
        steps.meta.outputs.tags
    }
}
labels : $
{
    {
        steps.meta.outputs.labels
    }
}
cache - from : type = gha
                          cache -
                      to : type = gha,
               mode = max

#Deployment Jobs
                                      deploy -
                                  staging : name : Deploy to Staging
                                                       runs -
                                                   on : ubuntu - latest needs : [ build - docker - frontend, build - docker - backend ] if : github.ref ==
                              'refs/heads/develop' environment : staging

                                                                     steps : -name : Checkout code
                                                                                         uses : actions /
                                                                                                checkout @v4

                                  - name : Deploy to staging server
                                               run : |
                                                     echo "Deploying to staging environment..."
#Add actual deployment commands here
#This would typically involve SSH to staging server
#and running docker - compose with staging configuration

                                                             deploy -
                                                             production : name : Deploy to Production
                                                                                     runs -
                                                                                 on : ubuntu - latest needs : [ build - docker - frontend, build - docker - backend ] if : github.ref ==
                                                         'refs/heads/main' environment : production

                                                                                             steps : -name : Checkout code
                                                                                                                 uses : actions /
                                                                                                                        checkout @v4

                                                             - name : Deploy to production server
                                                                          run : |
                                                                                echo "Deploying to production environment..."
#Add actual deployment commands here
#This would typically involve SSH to production server
#and running docker - compose with production configuration

#Notification Jobs
                                                                                    notify -
                                                                                    success : name : Notify Success
                                                                                                         runs -
                                                                                                     on : ubuntu - latest needs : [ deploy - staging, deploy - production ] if : always() &&
                      (needs.deploy - staging.result == 'success' || needs.deploy - production.result == 'success')

                              steps : -name : Notify deployment success
                                                  run : |
                                                        echo "Deployment completed successfully!"
#Add notification logic here(Slack, email, etc.)

                                                            notify -
                                                            failure : name : Notify Failure
                                                                                 runs -
                                                                             on : ubuntu - latest needs : [ test - frontend, test - backend, security - frontend, security - backend, build - frontend, build - backend ] if : always() &&
                      (contains(needs.*.result, 'failure') || contains(needs.*.result, 'cancelled'))

                                  steps : -name : Notify build /
                                                  test failure
                                                      run : |
                                                            echo "Pipeline failed! Please check the logs."
#Add notification logic here(Slack, email, etc.)