import{j as e,C as s,a as t,B as a,T as r}from"./index-D85gtc9V.js";import{r as i}from"./leaflet-QxLtkkBL.js";import"./react-Z2Iecplj.js";import"./genai-DmvHCT3V.js";const n=[{id:"pending",title:"Pending",color:"bg-yellow-100 border-yellow-300"},{id:"in-progress",title:"In Progress",color:"bg-blue-100 border-blue-300"},{id:"completed",title:"Completed",color:"bg-green-100 border-green-300"}],l=({todos:t,allTodos:a,user:r,personnel:l,onTaskStatusChange:d,onTaskSelectionChange:o,selectedTaskIds:c})=>{const[g,m]=i.useState(null),u=e=>{e.preventDefault()};return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:n.map(a=>{const r=(i=a.id,t.filter(e=>e.status===i));var i;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:a.title}),e.jsx("span",{className:"px-2 py-1 bg-gray-200 rounded-full text-sm font-medium",children:r.length})]}),e.jsx("div",{className:`min-h-96 p-4 rounded-lg border-2 border-dashed ${a.color} transition-colors`,onDragOver:u,onDrop:e=>((e,s)=>{e.preventDefault();const t=e.dataTransfer.getData("text/plain");t&&g&&d(t,s),m(null)})(e,a.id),children:e.jsxs("div",{className:"space-y-3",children:[r.map(t=>{const a=(r=t.assignedTo,l.find(e=>e.id===r));var r;const i=c?.includes(t.id)||!1;return e.jsx(s,{className:`cursor-move transition-all duration-200 hover:shadow-md ${i?"ring-2 ring-blue-500":""} ${g===t.id?"opacity-50":""}`,draggable:!0,onDragStart:e=>((e,s)=>{m(s),e.dataTransfer.setData("text/plain",s)})(e,t.id),onClick:()=>(e=>{if(!o||!c)return;const s=c.includes(e);o(s?c.filter(s=>s!==e):[...c,e])})(t.id),children:e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:t.title}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:t.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("div",{className:"flex items-center space-x-2",children:a&&e.jsxs("span",{children:["ðŸ‘¤ ",a.firstName," ",a.lastName]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"px-2 py-1 rounded text-xs "+("high"===t.priority?"bg-red-100 text-red-700":"medium"===t.priority?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"),children:t.priority}),t.dueDate&&e.jsxs("span",{className:"text-gray-500",children:["ðŸ“… ",new Date(t.dueDate).toLocaleDateString()]})]})]})]})},t.id)}),0===r.length&&e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("p",{children:"Drop tasks here"})})]})})]},a.id)})})},d=({user:n,addToast:d})=>{const[o,c]=i.useState(!0),[g,m]=i.useState([]),[u,x]=i.useState([]),[h,p]=i.useState([]),[f,j]=i.useState([]),[y,b]=i.useState([]),[N,v]=i.useState(new Set),[k,T]=i.useState(!1),w=i.useRef(null),S=i.useCallback(async()=>{const e=new AbortController;w.current?.abort(),w.current=e,c(!0);try{if(!n.companyId)return;const[s,a,r]=await Promise.all([t.getProjectsByUser(n.id,{signal:e.signal}),t.getTimesheetsByUser(n.id,{signal:e.signal}),t.getUsersByCompany(n.companyId,{signal:e.signal})]);if(e.signal.aborted)return;if(m(s),e.signal.aborted)return;if(b(a),e.signal.aborted)return;if(j(r),s.length>0){const a=s.map(e=>e.id),r=await t.getTodosByProjectIds(a,{signal:e.signal});if(e.signal.aborted)return;const i=r.filter(e=>e.assigneeId===n.id);if(x(i),e.signal.aborted)return;p(r)}}catch(s){if(e.signal.aborted)return;d("Failed to load daily data.","error")}finally{if(e.signal.aborted)return;c(!1)}},[n,d]);i.useEffect(()=>(S(),()=>{w.current?.abort()}),[S]);const C=i.useMemo(()=>g.find(e=>"ACTIVE"===e.status),[g]),D=i.useMemo(()=>y.find(e=>null===e.clockOut),[y]);return o?e.jsx(s,{children:"Loading your day..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"My Day"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(s,{className:"lg:col-span-1",children:[e.jsx("h2",{className:"font-semibold text-lg mb-2",children:"Time Clock"}),D?e.jsxs("div",{children:[e.jsxs("p",{className:"text-center text-lg",children:["Clocked in at ",e.jsx("strong",{children:g.find(e=>e.id===D.projectId)?.name})]}),e.jsx(a,{variant:"danger",className:"w-full mt-4",children:"Clock Out"})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-center text-lg",children:"You are currently clocked out."}),e.jsx(a,{variant:"primary",className:"w-full mt-4",children:"Clock In"})]})]}),e.jsxs(s,{className:"lg:col-span-2",children:[e.jsx("h2",{className:"font-semibold text-lg mb-2",children:"Quick Info"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Active Project:"})," ",C?.name||"None"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Pending Tasks:"})," ",u.filter(e=>e.status!==r.DONE).length]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"My Tasks"}),e.jsx(a,{onClick:async()=>{T(!0);try{const e=u.filter(e=>e.status!==r.DONE),{prioritizedTaskIds:s}=await t.prioritizeTasks(e,g,n.id);x(e=>{const t=new Map(e.map(e=>[e.id,e]));return[...s.map(e=>t.get(String(e))).filter(e=>!!e),...e.filter(e=>!s.includes(e.id))]}),d("Tasks prioritized by AI.","success")}catch(e){d("AI prioritization failed.","error")}finally{T(!1)}},isLoading:k,children:"âœ¨ Prioritize with AI"})]}),e.jsx(l,{todos:u,allTodos:h,user:n,personnel:f,onTaskStatusChange:async(e,s)=>{try{const a=await t.updateTodo(String(e),{status:s},n.id);x(s=>s.map(s=>s.id===e?a:s)),p(s=>s.map(s=>s.id===e?a:s)),d(`Task moved to ${s}.`,"success")}catch(a){d("Failed to update task status.","error")}},onTaskSelectionChange:e=>{v(s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},selectedTaskIds:N})]})]})};export{d as MyDayView};
