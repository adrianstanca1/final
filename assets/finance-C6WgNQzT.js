import{c as t}from"./index-D85gtc9V.js";const n=(t,n="GBP")=>new Intl.NumberFormat("en-GB",{style:"currency",currency:n,minimumFractionDigits:2,maximumFractionDigits:2}).format(t),e=t=>{if("number"==typeof t)return Number.isFinite(t)?t:0;if("string"==typeof t){const n=Number(t);return Number.isFinite(n)?n:0}return 0},a=t=>(t=>{if(!t)return null;const n=new Date(t).getTime();return Number.isNaN(n)?null:n})(t.dueAt||t.dueDate),u=t=>{const n=t.lineItems||[],a=n.length>0,u=n.reduce((t,n)=>t+e(n.quantity)*e(n.unitPrice??n.rate),0),r=e(t.subtotal),i=a?u:r||u,s=e(t.taxRate),m=e(t.retentionRate),o=i*s,l=e(t.taxAmount),c=a||!l?o:l,D=i*m,b=e(t.retentionAmount),f=a||!b?D:b,A=i+c-f,x=e(t.total),N=a||!x?A:x,E=t.payments||[],d=E.reduce((t,n)=>t+e(n.amount),0),h=e(t.amountPaid),y=a||void 0===t.balance?null:Math.max(0,e(t.balance)),F=[h,d];null!==y&&F.push(Math.max(0,N-y));const p=Math.max(0,...F),P=Math.max(0,N-p);return{subtotal:i,taxAmount:c,retentionAmount:f,total:N,amountPaid:p,balance:null!==y&&Number.isFinite(y)?Math.min(y,Math.max(0,N)):P,payments:E}},r=(n,e=Date.now())=>{const{balance:r}=u(n);if(n.status===t.CANCELLED)return t.CANCELLED;if(n.status===t.DRAFT)return t.DRAFT;if(n.status===t.PAID)return t.PAID;if(r<=0)return t.PAID;const i=a(n);return(n.status===t.SENT||n.status===t.OVERDUE)&&null!==i&&i<e?t.OVERDUE:n.status};export{r as a,n as f,u as g};
