import{j as e,C as s,B as t,a}from"./index-D85gtc9V.js";import{r as l}from"./leaflet-QxLtkkBL.js";import"./react-Z2Iecplj.js";import"./genai-DmvHCT3V.js";const n=({user:n,addToast:i,setActiveView:c})=>{const[d,r]=l.useState([]),[x,m]=l.useState([]),[h,o]=l.useState(!0);if(l.useEffect(()=>{(async()=>{try{const[e,s]=await Promise.all([a.getSafetyIncidents(),a.getProjects()]);r(e),m(s)}catch(e){i("Failed to load safety data","error")}finally{o(!1)}})()},[i]),h)return e.jsx(s,{children:"Loading safety data..."});const j=d.filter(e=>"open"===e.status),f=d.filter(e=>"resolved"===e.status);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Safety Management"}),e.jsx(t,{children:"Report Incident"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(s,{children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Open Incidents"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:j.length})]})}),e.jsx(s,{children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Resolved"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:f.length})]})}),e.jsx(s,{children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Total Incidents"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:d.length})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(s,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Incidents"}),e.jsx("div",{className:"space-y-3",children:d.slice(0,10).map(s=>e.jsxs("div",{className:"flex justify-between items-center p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.severity," â€¢ ",new Date(s.date).toLocaleDateString()]})]}),e.jsx("span",{className:"px-2 py-1 rounded text-xs "+("open"===s.status?"bg-red-100 text-red-700":"bg-green-100 text-green-700"),children:s.status})]},s.id))})]})}),e.jsx(s,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Safety Analytics"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Incident Rate"}),e.jsxs("span",{className:"font-medium",children:[(d.length/Math.max(x.length,1)*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Resolution Rate"}),e.jsxs("span",{className:"font-medium",children:[d.length>0?Math.round(f.length/d.length*100):0,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Days Since Last Incident"}),e.jsx("span",{className:"font-medium",children:d.length>0?Math.floor((Date.now()-Math.max(...d.map(e=>new Date(e.date).getTime())))/864e5):"N/A"})]})]})]})})]})]})};export{n as SafetyView};
