import{j as e,C as s,B as t,a}from"./index-D85gtc9V.js";import{r as l}from"./leaflet-QxLtkkBL.js";import"./react-Z2Iecplj.js";import"./genai-DmvHCT3V.js";const n=({onClose:a,onInvite:n})=>{const[r,i]=l.useState(""),[o,d]=l.useState(""),[c,x]=l.useState(!1),[m,h]=l.useState("form");return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:a,children:e.jsx(s,{className:"w-full max-w-md",onClick:e=>e.stopPropagation(),children:"form"===m?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"Invite New Company"}),e.jsx("p",{className:"text-sm text-slate-500 mb-6",children:"This will start the provisioning process for a new tenant. An invitation will be sent to the administrator's email to set up their account."}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),x(!0);try{await n(r,o),h("success")}finally{x(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"company-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),e.jsx("input",{type:"text",id:"company-name",value:r,onChange:e=>i(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"admin-email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Administrator Email"}),e.jsx("input",{type:"email",id:"admin-email",value:o,onChange:e=>d(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(t,{type:"button",variant:"secondary",onClick:a,children:"Cancel"}),e.jsx(t,{type:"submit",isLoading:c,children:"Send Invitation"})]})]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Invitation Sent!"}),e.jsxs("p",{className:"text-slate-600",children:["An email has been sent to ",e.jsx("span",{className:"font-semibold",children:o})," to set up the account for ",e.jsx("span",{className:"font-semibold",children:r}),"."]}),e.jsx(t,{onClick:a,className:"mt-6",children:"Done"})]})})})},r=({title:t,value:a,icon:l})=>e.jsxs(s,{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-lg bg-slate-100 text-slate-600",children:l}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-600",children:t}),e.jsx("p",{className:"text-3xl font-bold text-slate-900",children:a})]})]}),i=({health:s})=>{const t={OK:{icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),text:"text-green-700",bg:"bg-green-50"},DEGRADED:{icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-yellow-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.21 3.03-1.742 3.03H4.42c-1.532 0-2.492-1.696-1.742-3.03l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),text:"text-yellow-700",bg:"bg-yellow-50"},DOWN:{icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),text:"text-red-700",bg:"bg-red-50"}}[s.status];return e.jsxs("div",{className:`flex items-center gap-4 rounded-lg p-4 ${t.bg}`,children:[t.icon,e.jsxs("div",{children:[e.jsxs("p",{className:`font-semibold ${t.text}`,children:["System ",s.status]}),e.jsx("p",{className:`text-sm ${t.text}`,children:s.message})]})]})},o=({user:o,addToast:d})=>{const[c,x]=l.useState([]),[m,h]=l.useState(0),[p,u]=l.useState([]),[j,g]=l.useState(!0),[f,v]=l.useState(!1),[b]=l.useState({status:"OK",message:"All systems are operational."}),N=l.useRef(null),w=l.useCallback(async()=>{const e=new AbortController;N.current?.abort(),N.current=e,g(!0);try{const[s,t]=await Promise.all([a.getCompanies({signal:e.signal}),a.getPlatformUsageMetrics({signal:e.signal})]);if(e.signal.aborted)return;const l=await Promise.all(s.map(s=>a.getUsersByCompany(s.id,{signal:e.signal})));if(e.signal.aborted)return;const n=l.flat(),r=s.filter(e=>"0"!==e.id);if(e.signal.aborted)return;if(x(r),e.signal.aborted)return;if(h(n.filter(e=>"0"!==e.companyId).length),e.signal.aborted)return;u(t)}catch(s){if(e.signal.aborted)return;d("Failed to load platform data.","error")}finally{if(e.signal.aborted)return;g(!1)}},[d]);l.useEffect(()=>(w(),()=>{N.current?.abort()}),[w]);const y=c.reduce((e,s)=>e+(s.storageUsageGB||0),0),k=p.find(e=>e.name.toLowerCase().includes("active"));return j?e.jsx(s,{children:e.jsx("p",{children:"Loading Platform Dashboard..."})}):e.jsxs("div",{className:"space-y-6",children:[f&&e.jsx(n,{onClose:()=>v(!1),onInvite:async(e,s)=>{d(`Invitation sent to ${s} for ${e}.`,"success"),await w()}}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900",children:"Platform Administration"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Manage tenant accounts, monitor platform health, and keep an eye on adoption across the ecosystem."})]}),e.jsx(t,{onClick:()=>v(!0),children:"Invite New Company"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsx(r,{title:"Total Companies",value:c.length,icon:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7l9-4 9 4-9 4-9-4z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 10l-9 4-9-4"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M5 12v7l7 3 7-3v-7"})]})}),e.jsx(r,{title:"Users Across Tenants",value:m,icon:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M17 20v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4",strokeWidth:1.5}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M23 20v-2a4 4 0 00-3-3.87"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 3.13A4 4 0 0119 7"})]})}),e.jsx(r,{title:"Storage In Use",value:`${y.toFixed(1)} GB`,icon:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 6h16v12H4z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 10h8m-8 4h5"})]})}),e.jsx(r,{title:"Active last 24h",value:k?`${k.value} ${k.unit}`:"â€”",icon:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6v6l4 2"}),e.jsx("circle",{cx:"12",cy:"12",r:"9",strokeWidth:1.5})]})})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[e.jsxs(s,{className:"overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-border pb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Tenant roster"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Latest snapshot of every company on the platform."})]}),e.jsx(t,{variant:"secondary",size:"sm",onClick:()=>w(),children:"Refresh"})]}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-border text-sm",children:[e.jsx("thead",{className:"bg-muted/60 text-xs uppercase tracking-wide text-muted-foreground",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Company"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Storage"})]})}),e.jsx("tbody",{className:"divide-y divide-border bg-card",children:c.map(s=>e.jsxs("tr",{className:"hover:bg-muted/50",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold text-slate-900",children:s.name}),e.jsx("p",{className:"text-xs text-slate-500",children:s.email||"No contact email"})]}),e.jsx("td",{className:"px-4 py-3 capitalize text-slate-700",children:s.type?.toLowerCase().replace("_"," ")||"Not specified"}),e.jsx("td",{className:"px-4 py-3 text-slate-700",children:s.subscriptionPlan||"FREE"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-1 text-xs font-semibold "+("Suspended"===s.status?"bg-red-100 text-red-700":"bg-emerald-100 text-emerald-700"),children:s.status||"Active"})}),e.jsx("td",{className:"px-4 py-3 text-right text-slate-700",children:`${(s.storageUsageGB||0).toFixed(1)} GB`})]},s.id))})]})}),0===c.length&&e.jsx("div",{className:"py-8 text-center text-sm text-muted-foreground",children:"No tenant companies found. Invite your first partner to get started."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(s,{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Platform health"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Automated checks running every 5 minutes to spot emerging issues across the stack."}),e.jsx("div",{className:"mt-4",children:e.jsx(i,{health:b})})]}),e.jsxs(s,{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Usage metrics"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Key activity signals from the last 24 hours."}),e.jsxs("ul",{className:"mt-4 space-y-3 text-sm",children:[p.map(s=>e.jsxs("li",{className:"flex items-center justify-between border-b border-dashed border-border pb-2",children:[e.jsx("span",{className:"font-medium text-slate-700",children:s.name}),e.jsx("span",{className:"text-slate-900",children:`${s.value} ${s.unit}`})]},s.name)),0===p.length&&e.jsx("li",{className:"text-sm text-muted-foreground",children:"No usage data available."})]})]})]})]})]})};export{o as PrincipalAdminDashboard};
