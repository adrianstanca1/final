import{u as e,j as a,C as t,B as s,n,R as r}from"./index-D85gtc9V.js";import{r as i,R as l}from"./leaflet-QxLtkkBL.js";import"./react-Z2Iecplj.js";import"./genai-DmvHCT3V.js";const o=[{id:"personal",name:"Personal Info"},{id:"company",name:"Company"},{id:"role",name:"Your Role"},{id:"verify",name:"Verification"},{id:"terms",name:"Finish"}],c=({password:e=""})=>{const t=(()=>{let a=0;return e.length>=8&&a++,/[A-Z]/.test(e)&&a++,/[a-z]/.test(e)&&a++,/\d/.test(e)&&a++,/[^A-Za-z0-9]/.test(e)&&a++,a})(),s=t/5*100,n=t<3?"bg-destructive":t<5?"bg-yellow-500":"bg-green-500";return a.jsx("div",{className:"w-full bg-muted rounded-full h-1.5 mt-1",children:a.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${n}`,style:{width:`${s}%`}})})},m=({onClose:e,onSave:n,initialData:r})=>{const[l,o]=i.useState(r.name||""),[c,m]=i.useState(r.type||""),[d,p]=i.useState(r.email||""),[x,u]=i.useState(r.phone||""),[h,y]=i.useState(r.website||""),[j,g]=i.useState({});return a.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",onClick:e,children:a.jsxs(t,{className:"w-full max-w-lg",onClick:e=>e.stopPropagation(),children:[a.jsx("h3",{className:"text-lg font-bold mb-4",children:"Create Your Company"}),a.jsxs("form",{onSubmit:e=>{e.preventDefault();const a={};l.trim()||(a.name="Company name is required."),c||(a.type="Company type is required."),d&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d)||(a.email="A valid company email is required."),x.trim()||(a.phone="Company phone number is required."),g(a),0===Object.keys(a).length&&n({name:l,type:c,email:d,phone:x,website:h})},className:"space-y-4",children:[a.jsx(InputField,{label:"Company Name",name:"name",value:l,onChange:(e,a)=>o(a),error:j.name}),a.jsx(SelectField,{label:"Company Type",name:"type",value:c,onChange:(e,a)=>m(a),error:j.type,options:[{value:"GENERAL_CONTRACTOR",label:"General Contractor"},{value:"SUBCONTRACTOR",label:"Subcontractor"},{value:"SUPPLIER",label:"Supplier"},{value:"CONSULTANT",label:"Consultant"},{value:"CLIENT",label:"Client"}]}),a.jsx(InputField,{label:"Company Email",name:"email",type:"email",value:d,onChange:(e,a)=>p(a),error:j.email}),a.jsx(InputField,{label:"Company Phone",name:"phone",type:"tel",value:x,onChange:(e,a)=>u(a),error:j.phone}),a.jsx(InputField,{label:"Company Website (Optional)",name:"website",type:"url",value:h,onChange:(e,a)=>y(a)}),a.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[a.jsx(s,{type:"button",variant:"secondary",onClick:e,children:"Cancel"}),a.jsx(s,{type:"submit",children:"Save Company"})]})]})]})})},d=({onSwitchToLogin:d})=>{const{register:p,error:x,loading:u}=e(),[h,y]=i.useState("personal"),[j,g]=i.useState({}),[f,v]=i.useState({}),[N,b]=i.useState(null),[C,w]=i.useState(!1);i.useEffect(()=>{b(x)},[x]);const S=e=>{const a={};switch(e){case"personal":(!j.firstName||j.firstName.length<2)&&(a.firstName="First name is required."),(!j.lastName||j.lastName.length<2)&&(a.lastName="Last name is required."),j.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(j.email)||(a.email="A valid email is required."),(!j.password||j.password.length<8)&&(a.password="Password must be at least 8 characters."),j.password!==j.confirmPassword&&(a.confirmPassword="Passwords do not match.");break;case"company":j.companySelection?"create"!==j.companySelection||j.companyName&&j.companyType?"join"!==j.companySelection||j.inviteToken||(a.inviteToken="An invite token is required."):a.companyName="Company details are required. Please create or edit your company.":a.companySelection="Please choose an option.";break;case"role":j.role||(a.role="Please select a role.");break;case"verify":"123456"!==j.verificationCode&&(a.verificationCode="Enter the mock code: 123456.");break;case"terms":j.termsAccepted||(a.termsAccepted="You must accept the terms.")}return v(a),0===Object.keys(a).length},k=(e,a)=>{"companySelection"===e&&"create"===a&&w(!0),g(t=>({...t,[e]:a})),f[e]&&v(a=>{const t={...a};return delete t[e],t})},P=o.findIndex(e=>e.id===h);return a.jsxs(a.Fragment,{children:[C&&a.jsx(m,{onClose:()=>w(!1),onSave:({name:e,type:a,email:t,phone:s,website:n})=>{g(r=>({...r,companyName:e,companyType:a,companyEmail:t,companyPhone:s,companyWebsite:n,companySelection:"create"})),w(!1),f.companyName&&v(e=>{const a={...e};return delete a.companyName,a})},initialData:{name:j.companyName,type:j.companyType,email:j.companyEmail,phone:j.companyPhone,website:j.companyWebsite}}),a.jsx("div",{className:"min-h-screen bg-background flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-3xl",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsxs("div",{className:"inline-flex items-center justify-center gap-2 mb-2",children:[a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"w-10 h-10 text-primary",children:a.jsx("path",{fill:"currentColor",d:"M12 2L2 22h20L12 2z"})}),a.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"AS Agents"})]}),a.jsx("h2",{className:"text-muted-foreground",children:"Create your account"})]}),a.jsx("div",{className:"mb-8 px-4",children:a.jsx("div",{className:"flex items-center",children:o.map((e,t)=>a.jsxs(l.Fragment,{children:[a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center transition-colors "+(t<=P?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),children:t<P?"âœ“":t+1}),a.jsx("p",{className:"text-xs mt-1 text-center "+(t<=P?"font-semibold text-primary":"text-muted-foreground"),children:e.name})]}),t<o.length-1&&a.jsx("div",{className:"flex-grow h-0.5 transition-colors "+(t<P?"bg-primary":"bg-muted")})]},e.id))})}),a.jsxs(t,{children:[N&&a.jsx("div",{className:"mb-4 p-3 bg-destructive/10 text-destructive text-sm rounded-md",children:N}),a.jsx("div",{className:"space-y-6",children:(()=>{switch(h){case"personal":return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx(InputField2,{label:"First Name",name:"firstName",value:j.firstName||"",onChange:k,error:f.firstName}),a.jsx(InputField2,{label:"Last Name",name:"lastName",value:j.lastName||"",onChange:k,error:f.lastName})]}),a.jsx(InputField2,{label:"Email",name:"email",type:"email",value:j.email||"",onChange:k,error:f.email}),a.jsx(InputField2,{label:"Phone (Optional)",name:"phone",type:"tel",value:j.phone||"",onChange:k,error:f.phone}),a.jsx(InputField2,{label:"Password",name:"password",type:"password",value:j.password||"",onChange:k,error:f.password}),a.jsx(c,{password:j.password}),a.jsx(InputField2,{label:"Confirm Password",name:"confirmPassword",type:"password",value:j.confirmPassword||"",onChange:k,error:f.confirmPassword})]});case"company":return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(RadioCard,{name:"companySelection",value:"create",label:"Create a new company",description:"Set up a new workspace for your team.",checked:"create"===j.companySelection,onChange:k}),a.jsx(RadioCard,{name:"companySelection",value:"join",label:"Join an existing company",description:"You'll need an invite token from the company.",checked:"join"===j.companySelection,onChange:k}),f.companySelection&&a.jsx("p",{className:"text-xs text-destructive mt-1",children:f.companySelection})]}),"create"===j.companySelection&&j.companyName&&a.jsx(t,{className:"mt-4 bg-muted animate-card-enter",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:j.companyName}),a.jsx("p",{className:"text-sm text-muted-foreground",children:j.companyType?.replace(/_/g," ")}),a.jsx("p",{className:"text-sm text-muted-foreground",children:j.companyEmail}),a.jsx("p",{className:"text-sm text-muted-foreground",children:j.companyPhone}),j.companyWebsite&&a.jsx("p",{className:"text-sm text-muted-foreground",children:j.companyWebsite})]}),a.jsx(s,{variant:"secondary",size:"sm",onClick:()=>w(!0),children:"Edit"})]})}),f.companyName&&a.jsx("p",{className:"text-xs text-destructive mt-1",children:f.companyName}),"join"===j.companySelection&&a.jsx(t,{className:"mt-4 bg-muted animate-card-enter",children:a.jsx(InputField2,{label:"Company Invite Token",name:"inviteToken",value:j.inviteToken||"",onChange:k,error:f.inviteToken,placeholder:"Enter the token provided to you"})})]});case"role":const e=j.role?n[j.role]:new Set;return a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[[r.PROJECT_MANAGER,r.FOREMAN,r.OPERATIVE].map(e=>a.jsx(RadioCard,{name:"role",value:e,label:e.replace(/_/g," "),description:"",checked:j.role===e,onChange:k},e)),f.role&&a.jsx("p",{className:"text-xs text-destructive mt-1",children:f.role})]}),a.jsxs(t,{className:"bg-muted",children:[a.jsx("h4",{className:"font-semibold mb-2",children:"Role Permissions Preview"}),j.role?a.jsx("ul",{className:"text-sm space-y-1 list-disc list-inside max-h-60 overflow-y-auto",children:Array.from(e).map(e=>a.jsx("li",{className:"capitalize",children:String(e).replace(/_/g," ").toLowerCase()},e))}):a.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a role to see its permissions."})]})]});case"verify":return a.jsxs("div",{className:"text-center",children:[a.jsx("h3",{className:"font-semibold",children:"Verify Your Email"}),a.jsxs("p",{className:"text-muted-foreground text-sm mt-1 mb-4",children:['We\'ve "sent" a 6-digit code to ',j.email,". For this demo, please enter ",a.jsx("strong",{children:"123456"}),"."]}),a.jsx(InputField2,{label:"Verification Code",name:"verificationCode",value:j.verificationCode||"",onChange:(e,a)=>k(e,a.replace(/\D/g,"")),error:f.verificationCode,maxLength:6,inputClassName:"text-center tracking-[0.5em] text-2xl",isLabelSrOnly:!0})]});case"terms":return a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-start",children:[a.jsx("input",{id:"terms",type:"checkbox",checked:!!j.termsAccepted,onChange:e=>k("termsAccepted",e.target.checked),className:"h-4 w-4 text-primary focus:ring-ring border-border rounded mt-1"}),a.jsxs("label",{htmlFor:"terms",className:"ml-2 block text-sm text-muted-foreground",children:["I agree to the ",a.jsx("a",{href:"#",className:"font-medium text-primary hover:text-primary/90",children:"Terms and Conditions"})," and ",a.jsx("a",{href:"#",className:"font-medium text-primary hover:text-primary/90",children:"Privacy Policy"}),"."]})]}),f.termsAccepted&&a.jsx("p",{className:"text-xs text-destructive mt-1",children:f.termsAccepted})]});default:return null}})()}),a.jsxs("div",{className:"mt-8 flex justify-between items-center",children:["personal"!==h?a.jsx(s,{variant:"secondary",onClick:()=>{const e=o.findIndex(e=>e.id===h);e>0&&y(o[e-1].id)},children:"Back"}):a.jsx("div",{}),"terms"===h?a.jsx(s,{onClick:async()=>{if(S("terms")){b(null);try{await p(j)}catch(e){}}},isLoading:u,disabled:!j.termsAccepted,children:"Complete Registration"}):a.jsx(s,{onClick:()=>{if(S(h)){const e=o.findIndex(e=>e.id===h);e<o.length-1&&y(o[e+1].id)}},children:"Next"})]})]}),a.jsxs("p",{className:"mt-6 text-center text-sm text-muted-foreground",children:["Already have an account?"," ",a.jsx("button",{onClick:d,className:"font-semibold text-primary hover:text-primary/80",children:"Sign in"})]})]})})]})};export{d as UserRegistration};
