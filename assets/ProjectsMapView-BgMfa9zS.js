import{h as t,P as a,a as e,j as s,C as r}from"./index-D85gtc9V.js";import{r as o}from"./leaflet-QxLtkkBL.js";import{M as n}from"./MapView-D6xwUiFQ.js";import"./react-Z2Iecplj.js";import"./genai-DmvHCT3V.js";const i=({user:i,addToast:l})=>{const[c,d]=o.useState([]),[u,p]=o.useState(!0),m=o.useRef(null),g=o.useCallback(async()=>{const s=new AbortController;m.current?.abort(),m.current=s,p(!0);try{if(!i.companyId)return;let r;r=t(i,a.VIEW_ALL_PROJECTS)?e.getProjectsByCompany(i.companyId,{signal:s.signal}):e.getProjectsByUser(i.id,{signal:s.signal});const o=await r;if(s.signal.aborted)return;d(o)}catch(r){if(s.signal.aborted)return;l("Failed to load project locations.","error")}finally{if(s.signal.aborted)return;p(!1)}},[i,l]);o.useEffect(()=>(g(),()=>{m.current?.abort()}),[g]);const j=o.useMemo(()=>c.filter(t=>t.location&&t.location.lat&&t.location.lng).map(t=>{return{id:t.id,lat:t.location.lat,lng:t.location.lng,radius:t.geofenceRadius,status:(a=t.status,a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()),popupContent:s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold",children:t.name}),s.jsxs("p",{children:["Status: ",t.status]})]})};var a}),[c]);return u?s.jsx(r,{children:s.jsx("p",{children:"Loading map and project locations..."})}):s.jsx(r,{className:"h-screen p-0 overflow-hidden -m-6 lg:-m-8",children:s.jsx(n,{markers:j,height:"100%"})})};export{i as ProjectsMapView};
