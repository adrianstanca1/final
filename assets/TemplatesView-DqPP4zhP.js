import{a as e,j as t,C as s,B as a}from"./index-D85gtc9V.js";import{r as l}from"./leaflet-QxLtkkBL.js";import"./react-Z2Iecplj.js";import"./genai-DmvHCT3V.js";const r=({user:r,onClose:n,onSuccess:c,addToast:i})=>{const[o,d]=l.useState(""),[m,p]=l.useState(""),[u,x]=l.useState([""]),[h,j]=l.useState([""]),[f,g]=l.useState(!1),b=(e,t,s,a)=>{const l=[...s];l[e]=t,e===l.length-1&&t&&l.push(""),a(l.filter(e=>void 0!==e))};return t.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",onClick:n,children:t.jsxs(s,{className:"w-full max-w-2xl",onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Template"}),t.jsxs("form",{onSubmit:async t=>{t.preventDefault(),g(!0);try{const t={name:o,description:m,templateTasks:u.filter(e=>e.trim()).map(e=>({text:e})),documentCategories:h.filter(e=>e.trim())};await e.createProjectTemplate(t,r.id),i("Template created successfully.","success"),c(),n()}catch(s){i("Failed to create template.","error")}finally{g(!1)}},className:"space-y-4",children:[t.jsx("input",{type:"text",value:o,onChange:e=>d(e.target.value),placeholder:"Template Name",className:"w-full p-2 border rounded",required:!0}),t.jsx("textarea",{value:m,onChange:e=>p(e.target.value),placeholder:"Description",className:"w-full p-2 border rounded",rows:3}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold",children:"Template Tasks"}),u.map((e,s)=>t.jsx("input",{type:"text",value:e,onChange:e=>b(s,e.target.value,u,x),placeholder:"+ Add task",className:"w-full p-1 border-b mt-1"},s))]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold",children:"Document Categories"}),h.map((e,s)=>t.jsx("input",{type:"text",value:e,onChange:e=>b(s,e.target.value,h,j),placeholder:"+ Add category",className:"w-full p-1 border-b mt-1"},s))]}),t.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[t.jsx(a,{variant:"secondary",onClick:n,children:"Cancel"}),t.jsx(a,{type:"submit",isLoading:f,children:"Save Template"})]})]})]})})},n=({user:n,addToast:c})=>{const[i,o]=l.useState([]),[d,m]=l.useState(!0),[p,u]=l.useState(!1),x=l.useRef(null),h=l.useCallback(async()=>{const t=new AbortController;x.current?.abort(),x.current=t,m(!0);try{if(!n.companyId)return;const s=await e.getProjectTemplates(n.companyId,{signal:t.signal});if(t.signal.aborted)return;o(s)}catch(s){if(t.signal.aborted)return;c("Failed to load templates.","error")}finally{if(t.signal.aborted)return;m(!1)}},[n.companyId,c]);return l.useEffect(()=>(h(),()=>{x.current?.abort()}),[h]),d?t.jsx(s,{children:t.jsx("p",{children:"Loading templates..."})}):t.jsxs("div",{className:"space-y-6",children:[p&&t.jsx(r,{user:n,onClose:()=>u(!1),onSuccess:h,addToast:c}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h2",{className:"text-3xl font-bold text-slate-800 dark:text-slate-100",children:"Project Templates"}),t.jsx(a,{onClick:()=>u(!0),children:"Create Template"})]}),t.jsx("div",{className:"space-y-4",children:i.map(e=>t.jsxs(s,{children:[t.jsx("h3",{className:"font-bold text-lg",children:e.name}),t.jsx("p",{className:"text-sm text-slate-600",children:e.description}),t.jsxs("div",{className:"mt-4 flex gap-4 text-sm text-slate-500",children:[t.jsxs("span",{children:[t.jsx("strong",{children:e.templateTasks.length})," tasks"]}),t.jsxs("span",{children:[t.jsx("strong",{children:e.documentCategories.length})," document categories"]})]})]},e.id))})]})};export{n as TemplatesView};
