import{j as e,B as s,C as t,a,h as r,P as l,R as n,A as i}from"./index-D85gtc9V.js";import{r as c}from"./leaflet-QxLtkkBL.js";import"./react-Z2Iecplj.js";import"./genai-DmvHCT3V.js";const d=({user:a,addToast:r,onBack:l})=>{const[n,i]=c.useState([{role:"model",text:"Hello! I am your AI construction advisor. I can help you with project planning, safety recommendations, cost estimates, and more. What can I assist you with today?",timestamp:new Date}]),[d,o]=c.useState(""),[m,x]=c.useState(!1),u=async()=>{if(!d.trim())return;const e={role:"user",text:d.trim(),timestamp:new Date};i(s=>[...s,e]),o(""),x(!0);try{await new Promise(e=>setTimeout(e,1e3));const e={role:"model",text:"This is a simulated AI response. In the actual implementation, this would connect to the Google Gemini API to provide construction-specific guidance and recommendations.",timestamp:new Date};i(s=>[...s,e])}catch(s){r("Failed to get AI response","error")}finally{x(!1)}};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(s,{variant:"ghost",onClick:l,className:"p-2",children:"Back"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"AI Construction Advisor"})]})}),e.jsxs(t,{className:"h-96 flex flex-col",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[n.map((s,t)=>e.jsx("div",{className:"flex "+("user"===s.role?"justify-end":"justify-start"),children:e.jsxs("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg "+("user"===s.role?"bg-blue-500 text-white":"bg-gray-200 text-gray-900"),children:[e.jsx("p",{className:"text-sm",children:s.text}),e.jsx("p",{className:"text-xs mt-1 "+("user"===s.role?"text-blue-100":"text-gray-500"),children:s.timestamp.toLocaleTimeString()})]})},t)),m&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-200 text-gray-900 px-4 py-2 rounded-lg",children:e.jsx("p",{className:"text-sm",children:"AI is typing..."})})})]}),e.jsx("div",{className:"border-t p-4",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("textarea",{value:d,onChange:e=>o(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),u())},placeholder:"Ask me anything about construction, safety, or project management...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2,disabled:m}),e.jsx(s,{onClick:u,disabled:!d.trim()||m,className:"px-6",children:"Send"})]})})]})]})},o=({user:r,addToast:l,onBack:n})=>{const[i,d]=c.useState(""),[o,m]=c.useState(""),[x,u]=c.useState(null),[h,p]=c.useState(!1),g=(e,s)=>{navigator.clipboard.writeText(e),l(`${s} copied to clipboard!`,"success")};return e.jsxs(t,{children:[e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Provide a link to the tender document and list your company's key strengths to generate a draft bid package."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tender-url",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tender Document URL (Optional)"}),e.jsx("input",{id:"tender-url",type:"url",value:i,onChange:e=>d(e.target.value),className:"w-full p-2 border rounded-md",placeholder:"https://example.com/tender.pdf",disabled:h})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"company-strengths",className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Strengths"}),e.jsx("textarea",{id:"company-strengths",value:o,onChange:e=>m(e.target.value),rows:4,className:"w-full p-2 border rounded-md",placeholder:"e.g., 'Specialists in sustainable building materials', '15 years of experience in high-rise construction', 'Excellent safety record'...",disabled:h})]}),e.jsx(s,{onClick:async()=>{if(o.trim()){p(!0),u(null);try{const e=await a.generateBidPackage(i,o,r.id);u(e),l("Bid package generated!","success")}catch(e){console.error(e),l("Failed to generate bid package.","error")}finally{p(!1)}}else l("Please provide your company strengths.","error")},isLoading:h,disabled:!o.trim(),children:"Generate Bid Package"})]}),h&&e.jsxs("div",{className:"text-center py-10",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-slate-800"}),e.jsx("p",{className:"mt-2 text-slate-600",children:"AI is drafting your document..."})]}),x&&e.jsxs("div",{className:"mt-6 pt-4 border-t animate-card-enter space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-semibold text-lg",children:"Executive Summary"}),e.jsx(s,{variant:"secondary",size:"sm",onClick:()=>g(x.summary,"Summary"),children:"Copy"})]}),e.jsx("div",{className:"p-4 border rounded-md bg-white whitespace-pre-wrap text-sm",children:x.summary})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-semibold text-lg",children:"Cover Letter"}),e.jsx(s,{variant:"secondary",size:"sm",onClick:()=>g(x.coverLetter,"Cover Letter"),children:"Copy"})]}),e.jsx("div",{className:"p-4 border rounded-md bg-white whitespace-pre-wrap text-sm",children:x.coverLetter})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg mb-2",children:"Submission Checklist"}),e.jsx("ul",{className:"list-disc list-inside p-4 border rounded-md bg-white space-y-2 text-sm",children:x.checklist.map((s,t)=>e.jsx("li",{children:s},t))})]})]})]})},m=e=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:0}).format(e),x=({user:a,addToast:r,onBack:l,project:n})=>{const[i,d]=c.useState(null),[o,x]=c.useState(!1),[u,h]=c.useState({projectType:"residential",size:"",location:"",duration:"",complexity:"medium"}),p=i?i.materials+i.labor+i.equipment+i.overhead+i.contingency:0;return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(s,{variant:"ghost",onClick:l,className:"p-2",children:"Back"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Cost Estimator"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(t,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Project Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Project Type"}),e.jsxs("select",{value:u.projectType,onChange:e=>h({...u,projectType:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"residential",children:"Residential"}),e.jsx("option",{value:"commercial",children:"Commercial"}),e.jsx("option",{value:"industrial",children:"Industrial"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Size (sq.m) *"}),e.jsx("input",{type:"number",value:u.size,onChange:e=>h({...u,size:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter project size"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location *"}),e.jsx("input",{type:"text",value:u.location,onChange:e=>h({...u,location:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter project location"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Duration (months) *"}),e.jsx("input",{type:"number",value:u.duration,onChange:e=>h({...u,duration:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter estimated duration"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complexity"}),e.jsxs("select",{value:u.complexity,onChange:e=>h({...u,complexity:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsx(s,{onClick:async()=>{if(u.size&&u.location&&u.duration){x(!0);try{await new Promise(e=>setTimeout(e,2e3));const e=parseInt(u.size)||1e3,s={residential:800,commercial:1200,industrial:1e3}[u.projectType]||800,t={low:.8,medium:1,high:1.3}[u.complexity]||1,a=e*s*.4*t,l=e*s*.35*t,n=e*s*.15*t,i=.1*(a+l+n),c={materials:a,labor:l,equipment:n,overhead:i,contingency:.1*(a+l+n+i),summary:`Cost estimate for ${u.projectType} project of ${u.size} sq.m in ${u.location}`};d(c),r("Cost estimate generated successfully","success")}catch(e){r("Failed to generate cost estimate","error")}finally{x(!1)}}else r("Please fill in all required fields","error")},disabled:o,className:"w-full",children:o?"Generating...":"Generate Estimate"})]})]})}),e.jsx(t,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Cost Breakdown"}),i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Materials"}),e.jsx("p",{className:"text-lg font-semibold text-blue-600",children:m(i.materials)})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Labor"}),e.jsx("p",{className:"text-lg font-semibold text-green-600",children:m(i.labor)})]}),e.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Equipment"}),e.jsx("p",{className:"text-lg font-semibold text-orange-600",children:m(i.equipment)})]}),e.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Overhead"}),e.jsx("p",{className:"text-lg font-semibold text-purple-600",children:m(i.overhead)})]})]}),e.jsxs("div",{className:"bg-yellow-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Contingency (10%)"}),e.jsx("p",{className:"text-lg font-semibold text-yellow-600",children:m(i.contingency)})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Total Estimate:"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:m(p)})]})}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:i.summary}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"* This is a preliminary estimate. Actual costs may vary based on specific requirements and market conditions."})]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"💰"}),e.jsx("p",{children:"Generate an estimate to see cost breakdown"})]})]})})]})]})},u=({user:i,addToast:d,onBack:o})=>{const[m,x]=c.useState([]),[u,h]=c.useState(""),[p,g]=c.useState((new Date).toISOString().split("T")[0]),[j,y]=c.useState(!1),[b,f]=c.useState(null),v=c.useCallback(async()=>{if(i.companyId)try{let e;e=r(i,l.VIEW_ALL_PROJECTS)?await a.getProjectsByCompany(i.companyId):i.role===n.PROJECT_MANAGER?await a.getProjectsByManager(i.id):await a.getProjectsByUser(i.id),x(e),e.length>0&&h(e[0].id.toString())}catch(e){d("Failed to load projects.","error")}},[i,d]);c.useEffect(()=>{v()},[v]);return e.jsxs(t,{children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-700 mb-2",children:"AI Daily Summary Generator"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Generate a daily progress report for any project using AI."}),e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-slate-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"project-select",className:"block text-sm font-medium text-gray-700 mb-1",children:"Project"}),e.jsx("select",{id:"project-select",value:u,onChange:e=>h(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md",children:m.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-select",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),e.jsx("input",{type:"date",id:"date-select",value:p,onChange:e=>g(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md"})]})]}),e.jsx(s,{onClick:async()=>{if(u&&p){y(!0),f(null);try{const e=await a.generateDailySummary(u,new Date(p),i.id);f(e),d("Daily summary generated!","success")}catch(e){d("Failed to generate summary.","error")}finally{y(!1)}}else d("Please select a project and a date.","error")},isLoading:j,children:"Generate Summary"})]}),e.jsxs("div",{className:"mt-6",children:[j&&e.jsxs("div",{className:"text-center py-10",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-slate-800"}),e.jsx("p",{className:"mt-2 text-slate-600",children:"AI is analyzing project data for the selected day..."})]}),b&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg mb-2",children:"Generated Report:"}),e.jsx("div",{className:"p-4 border rounded-md bg-white whitespace-pre-wrap font-mono text-sm",children:b}),e.jsx(s,{variant:"secondary",className:"mt-4",onClick:()=>navigator.clipboard.writeText(b).then(()=>d("Report copied to clipboard!","success")),children:"Copy Report"})]})]})]})},h=({user:r,addToast:l,onBack:n})=>{const[i,d]=c.useState(""),[o,m]=c.useState("UK"),[x,u]=c.useState(!1),[h,p]=c.useState(null);return e.jsxs(t,{children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-700 mb-2",children:"FundingBot"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Discover grants and funding opportunities for your construction projects."}),e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-slate-50",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"keywords",className:"block text-sm font-medium text-gray-700 mb-1",children:"Keywords"}),e.jsx("input",{type:"text",id:"keywords",value:i,onChange:e=>d(e.target.value),placeholder:"e.g. retrofit, SME, green energy",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-700 mb-1",children:"Location"}),e.jsx("input",{type:"text",id:"location",value:o,onChange:e=>m(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx(s,{onClick:async()=>{if(i.trim()&&o.trim()){u(!0),p(null);try{const e=await a.findGrants(i,o);p(e),l(`Found ${e.length} potential grants.`,"success")}catch(e){l("Failed to fetch grants from AI.","error")}finally{u(!1)}}else l("Please provide both keywords and a location.","error")},isLoading:x,children:"Find Grants"})]}),e.jsxs("div",{className:"mt-6",children:[null===h&&!x&&e.jsx("p",{className:"text-center text-slate-500 py-4",children:"No results yet. Try a search."}),h&&0===h.length&&e.jsx("p",{className:"text-center text-slate-500 py-4",children:"No matching grants found for your search."}),h&&h.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-lg",children:"Funding Opportunities Found:"}),h.map(s=>e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsx("h5",{className:"font-semibold text-green-700",children:s.name}),e.jsxs("p",{className:"text-sm font-medium text-slate-600",children:[s.agency," - ",s.amount]}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:s.description}),e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-green-600 hover:underline mt-2 inline-block",children:"Learn More →"})]},s.id))]})]})]})},p=({user:r,addToast:l,onBack:n})=>{const[i,d]=c.useState(""),[o,m]=c.useState(!1),[x,u]=c.useState(null);return e.jsxs(t,{children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-700 mb-2",children:"RiskBot"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Analyze text for compliance and financial risks."}),e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-slate-50",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"text-to-analyze",className:"block text-sm font-medium text-gray-700 mb-1",children:"Text to Analyze"}),e.jsx("textarea",{id:"text-to-analyze",value:i,onChange:e=>d(e.target.value),rows:8,placeholder:"Paste a quote, invoice, or project notes to analyze risks...",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx(s,{onClick:async()=>{if(i.trim()){m(!0),u(null);try{const e=await a.analyzeForRisks(i);u(e),l("Risk analysis complete.","success")}catch(e){l("Failed to perform risk analysis.","error")}finally{m(!1)}}else l("Please paste some text to analyze.","error")},isLoading:o,children:"Analyze"})]}),e.jsxs("div",{className:"mt-6",children:[null===x&&!o&&e.jsx("p",{className:"text-center text-slate-500 py-4",children:"No analysis yet."}),x&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-lg",children:"Analysis Result:"}),e.jsxs("div",{className:"p-4 bg-slate-100 rounded-lg",children:[e.jsx("p",{className:"font-semibold",children:"Summary:"}),e.jsx("p",{className:"text-slate-700",children:x.summary})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-2",children:"Identified Risks:"}),e.jsx("div",{className:"space-y-3",children:x.identifiedRisks.map((s,t)=>e.jsxs("div",{className:"p-3 border rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"font-semibold",children:[s.severity," Risk:"]}),e.jsx("p",{children:s.description})]}),e.jsxs("p",{className:"text-sm text-green-700",children:[e.jsx("span",{className:"font-medium",children:"Recommendation:"})," ",s.recommendation]})]},t))})]})]})]})]})},g=({user:r,addToast:l})=>{const[n,i]=c.useState([]),[d,o]=c.useState([]),[m,x]=c.useState(""),[u,h]=c.useState(!1),[p,g]=c.useState(null),j=c.useRef(null),y=c.useCallback(async()=>{const e=new AbortController;if(j.current?.abort(),j.current=e,r.companyId)try{const[s,t]=await Promise.all([a.getProjectsByCompany(r.companyId,{signal:e.signal}),a.getSafetyIncidentsByCompany(r.companyId,{signal:e.signal})]);if(e.signal.aborted)return;if(i(s),e.signal.aborted)return;if(o(t),e.signal.aborted)return;if(s.length>0){if(e.signal.aborted)return;x(s[0].id.toString())}}catch(s){if(e.signal.aborted)return;l("Failed to load data for analysis.","error")}},[r.companyId,l]);c.useEffect(()=>(y(),()=>{j.current?.abort()}),[y]);return e.jsxs(t,{children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-700 mb-2",children:"AI Safety Analysis"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Let AI analyze incident reports to identify trends and recommend preventative actions."}),e.jsxs("div",{className:"flex gap-4 items-end p-4 border rounded-lg bg-slate-50",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("label",{htmlFor:"project-select",className:"block text-sm font-medium text-gray-700 mb-1",children:"Project"}),e.jsx("select",{id:"project-select",value:m,onChange:e=>x(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md",children:n.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]}),e.jsx(s,{onClick:async()=>{if(!m)return void l("Please select a project.","error");const e=d.filter(e=>e.projectId.toString()===m);if(0!==e.length){h(!0),g(null);try{await new Promise(e=>setTimeout(e,1500));const s={report:`Analysis for project #${m}:\n- Common issue: Slips on wet surfaces (${e.length} incidents).\n- Recommendation: Increase signage and regular clean-up patrols.`};g(s.report),l("Safety analysis generated!","success")}catch(s){l("Failed to generate analysis.","error")}finally{h(!1)}}else l("No incidents recorded for this project to analyze.","error")},isLoading:u,children:"Analyze Incidents"})]}),e.jsxs("div",{className:"mt-6",children:[u&&e.jsxs("div",{className:"text-center py-10",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-slate-800"}),e.jsx("p",{className:"mt-2 text-slate-600",children:"AI is analyzing safety data..."})]}),p&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg mb-2",children:"Generated Analysis:"}),e.jsx("div",{className:"p-4 border rounded-md bg-white whitespace-pre-wrap font-mono text-sm",children:p})]})]})]})},j=({user:a,addToast:r,onBack:l})=>{const[n,i]=c.useState(null),[d,o]=c.useState(!1),[m,x]=c.useState(null),[u,h]=c.useState(null);return e.jsxs(t,{children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-700 mb-2",children:"AI Site Inspector"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Upload a photo from the site to automatically check progress and identify potential safety hazards."}),e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-slate-50",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"site-photo",className:"block text-sm font-medium text-gray-700 mb-1",children:"Site Photo"}),e.jsx("input",{type:"file",id:"site-photo",accept:"image/*",onChange:e=>{const s=e.target.files?.[0]||null;if(i(s),s){const e=new FileReader;e.onloadend=()=>{h(e.result)},e.readAsDataURL(s)}else h(null)},className:"w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-sky-50 file:text-sky-700 hover:file:bg-sky-100"})]}),u&&e.jsx("div",{className:"mt-4",children:e.jsx("img",{src:u,alt:"Site preview",className:"max-h-64 w-auto rounded-lg mx-auto"})}),e.jsx(s,{onClick:async()=>{if(n){o(!0),x(null);try{await new Promise(e=>setTimeout(e,2e3)),x("**AI Site Inspection Report**\n- **Progress:** Wall framing for the west wing appears to be ~75% complete, consistent with the project schedule.\n- **Safety Concern (High):** An unsecured ladder is visible near gridline C-4. Immediate action required.\n- **Observation:** Debris accumulation is noted in the staging area. Recommend cleanup to maintain a safe work environment.\n- **Materials:** Stacks of drywall appear to be properly stored and covered."),r("Site photo analysis complete.","success")}catch(e){r("Failed to perform analysis.","error")}finally{o(!1)}}else r("Please select an image to analyze.","error")},isLoading:d,disabled:!n,children:"Analyze Photo"})]}),e.jsxs("div",{className:"mt-6",children:[d&&e.jsxs("div",{className:"text-center py-10",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-slate-800"}),e.jsx("p",{className:"mt-2 text-slate-600",children:"AI is inspecting your photo..."})]}),m&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg mb-2",children:"Analysis Result:"}),e.jsx("div",{className:"p-4 border rounded-md bg-white whitespace-pre-wrap font-mono text-sm",children:m})]})]})]})},y=({user:s,addToast:r})=>{const[l,n]=c.useState([]),[d,o]=c.useState([]),[m,x]=c.useState(!0),u=c.useRef(null),h=c.useCallback(async()=>{const e=new AbortController;u.current?.abort(),u.current=e;try{x(!0);const[s,t]=await Promise.all([a.getUsers(),a.getProjects()]);if(!e.signal.aborted){const e=s.map(e=>({...e,projectId:null}));n(e),o(t)}}catch(s){e.signal.aborted||r("Failed to fetch workforce data","error")}finally{e.signal.aborted||x(!1)}},[r]);c.useEffect(()=>(h(),()=>{u.current?.abort()}),[h]);const p=async(e,s)=>{try{s?(await a.assignUserToProject(e,s),r("User assigned successfully","success")):(await a.unassignUserFromProject(e),r("User unassigned successfully","success")),n(t=>t.map(t=>t.id===e?{...t,projectId:s}:t))}catch(t){r("Failed to update assignment","error")}};if(m)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-300 rounded w-1/3"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((s,a)=>e.jsx(t,{children:e.jsx("div",{className:"h-24 bg-gray-300 rounded"})},a))})]})});const g=l.filter(e=>!e.projectId),j=l.filter(e=>e.projectId);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Workforce Planning"}),e.jsx("button",{onClick:h,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Refresh"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(t,{children:e.jsxs("div",{className:"p-4",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 text-gray-900",children:["Available Workers (",g.length,")"]}),e.jsxs("div",{className:"space-y-3",children:[g.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(i,{user:s}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.role})]})]}),e.jsxs("select",{value:"",onChange:e=>p(s.id,e.target.value||null),className:"px-3 py-1 border rounded text-sm",children:[e.jsx("option",{value:"",children:"Assign to project..."}),d.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]},s.id)),0===g.length&&e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No available workers"})]})]})}),e.jsx(t,{children:e.jsxs("div",{className:"p-4",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 text-gray-900",children:["Project Assignments (",j.length,")"]}),e.jsxs("div",{className:"space-y-4",children:[d.map(s=>{const t=j.filter(e=>e.projectId===s.id);return 0===t.length?null:e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:s.name}),e.jsx("div",{className:"space-y-2",children:t.map(s=>e.jsxs("div",{className:"flex items-center justify-between pl-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(i,{user:s,size:"sm"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.role})]})]}),e.jsx("button",{onClick:()=>p(s.id,null),className:"text-red-600 hover:text-red-800 text-sm",children:"Unassign"})]},s.id))})]},s.id)}),0===j.length&&e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No project assignments"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(t,{children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:l.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Workers"})]})}),e.jsx(t,{children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:j.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Assigned"})]})}),e.jsx(t,{children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:g.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Available"})]})}),e.jsx(t,{children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:d.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Active Projects"})]})})]})]})},b=e=>{const s=new Date(e),t=s.getDay(),a=s.getDate()-t+(0===t?-6:1);return new Date(new Date(s.setDate(a)).setHours(0,0,0,0))},f=e=>e.toISOString().split("T")[0],v=({user:r,addToast:l})=>{const[n,d]=c.useState([]),[o,m]=c.useState([]),[x,u]=c.useState([]),[h,p]=c.useState([]),[g,j]=c.useState(b(new Date)),[y,v]=c.useState(!0),[N,w]=c.useState(null),k=c.useRef(null),S=c.useMemo(()=>{const e=[],s=new Date(g);for(let t=0;t<7;t++){const a=new Date(s);a.setDate(s.getDate()+t),e.push(a)}return e},[g]),C=c.useCallback(async()=>{const e=new AbortController;k.current?.abort(),k.current=e;try{v(!0);const[s,t,r]=await Promise.all([a.getUsers(),a.getProjects(),a.getEquipment()]);if(!e.signal.aborted){d(s),m(t),u(r);const e=[];s.slice(0,3).forEach((s,a)=>{S.forEach((r,l)=>{l<5&&e.push({id:`user-${s.id}-${f(r)}`,type:"user",resourceId:s.id,projectId:t[a%t.length]?.id||"",date:f(r),hours:8})})}),r.slice(0,2).forEach((s,a)=>{S.forEach((r,l)=>{l<5&&l>0&&e.push({id:`equipment-${s.id}-${f(r)}`,type:"equipment",resourceId:s.id,projectId:t[a%t.length]?.id||"",date:f(r),hours:8})})}),p(e)}}catch(s){e.signal.aborted||l("Failed to fetch resource data","error")}finally{e.signal.aborted||v(!1)}},[l,S]);c.useEffect(()=>(C(),()=>{k.current?.abort()}),[C]);const A=e=>{const s=new Date(g);s.setDate(g.getDate()+("next"===e?7:-7)),j(b(s))},I=(e,s,t)=>h.find(a=>a.type===e&&a.resourceId===s&&a.date===f(t));return y?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-300 rounded w-1/3"}),e.jsx("div",{className:"grid grid-cols-8 gap-2",children:[...Array(56)].map((s,t)=>e.jsx("div",{className:"h-16 bg-gray-300 rounded"},t))})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Resource Scheduler"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(s,{onClick:()=>A("prev"),variant:"outline",size:"sm",children:"← Previous"}),e.jsxs("span",{className:"text-sm font-medium",children:[g.toLocaleDateString("en-US",{month:"short",day:"numeric"})," - ",new Date(g.getTime()+5184e5).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]}),e.jsx(s,{onClick:()=>A("next"),variant:"outline",size:"sm",children:"Next →"})]}),e.jsx(s,{onClick:C,children:"Refresh"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"min-w-full",children:[e.jsxs("div",{className:"grid grid-cols-8 gap-2 mb-4",children:[e.jsx("div",{className:"p-3 bg-gray-50 rounded font-medium text-center",children:"Resource"}),S.map(s=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded text-center",children:[e.jsx("div",{className:"font-medium",children:s.toLocaleDateString("en-US",{weekday:"short"})}),e.jsx("div",{className:"text-sm text-gray-500",children:s.getDate()})]},s.toISOString()))]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-gray-900",children:"Workers"}),n.slice(0,5).map(s=>e.jsxs("div",{className:"grid grid-cols-8 gap-2 mb-2",children:[e.jsxs("div",{className:"p-3 border rounded flex items-center space-x-3",children:[e.jsx(i,{user:s,size:"sm"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.role})]})]}),S.map(t=>{const a=I("user",s.id,t),r=a?o.find(e=>e.id===a.projectId):null;return e.jsx("div",{className:"p-2 border rounded",children:a?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs font-medium text-blue-700",children:r?.name||"Unknown"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[a.hours,"h"]})]}):e.jsx("div",{className:"text-center text-xs text-gray-400",children:"Available"})},t.toISOString())})]},s.id))]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-gray-900",children:"Equipment"}),x.slice(0,3).map(s=>e.jsxs("div",{className:"grid grid-cols-8 gap-2 mb-2",children:[e.jsxs("div",{className:"p-3 border rounded",children:[e.jsx("div",{className:"font-medium text-sm",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.type})]}),S.map(t=>{const a=I("equipment",s.id,t),r=a?o.find(e=>e.id===a.projectId):null;return e.jsx("div",{className:"p-2 border rounded",children:a?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs font-medium text-green-700",children:r?.name||"Unknown"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[a.hours,"h"]})]}):e.jsx("div",{className:"text-center text-xs text-gray-400",children:"Available"})},t.toISOString())})]},s.id))]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(t,{children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Workers"})]})}),e.jsx(t,{children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:x.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Equipment"})]})}),e.jsx(t,{children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:o.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Projects"})]})}),e.jsx(t,{children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:h.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Assignments"})]})})]})]})},N=({user:s,addToast:a,setActiveView:n})=>{const[i,m]=c.useState(null),b=[{id:"ai-advisor",name:"AI Advisor",description:"Chat with an AI expert on project management.",icon:"💬",component:e.jsx(d,{user:s,addToast:a,onBack:()=>m(null)}),permission:!0},{id:"bid-generator",name:"Bid Package Generator",description:"Generate professional bid packages and cover letters.",icon:"📝",component:e.jsx(o,{user:s,addToast:a,onBack:()=>m(null)}),permission:!0},{id:"cost-estimator",name:"Cost Estimator",description:"Estimate project costs based on specifications.",icon:"🧮",component:e.jsx(x,{user:s,addToast:a,onBack:()=>m(null)}),permission:!0},{id:"daily-summary",name:"Daily Summary Generator",description:"AI-powered daily progress reports.",icon:"📰",component:e.jsx(u,{user:s,addToast:a,onBack:()=>m(null)}),permission:!0},{id:"funding-bot",name:"FundingBot",description:"Discover grants and funding opportunities.",icon:"💰",component:e.jsx(h,{user:s,addToast:a,onBack:()=>m(null)}),permission:!0},{id:"risk-bot",name:"RiskBot",description:"Analyze documents for compliance and financial risks.",icon:"⚠️",component:e.jsx(p,{user:s,addToast:a,onBack:()=>m(null)}),permission:!0},{id:"safety-analysis",name:"Safety Analysis",description:"Identify trends from safety incident reports.",icon:"🛡️",component:e.jsx(g,{user:s,addToast:a}),permission:!0},{id:"site-inspector",name:"AI Site Inspector",description:"Analyze site photos for progress and hazards.",icon:"📸",component:e.jsx(j,{user:s,addToast:a,onBack:()=>m(null)}),permission:!0},{id:"workforce-planner",name:"Workforce Planner",description:"Plan and allocate personnel to projects.",icon:"👥",component:e.jsx(y,{user:s,addToast:a}),permission:r(s,l.MANAGE_TEAM)},{id:"resource-scheduler",name:"Resource Scheduler",description:"View team and equipment schedules.",icon:"🗓️",component:e.jsx(v,{user:s,addToast:a}),permission:r(s,l.MANAGE_EQUIPMENT)}].filter(e=>e.permission),f=b.find(e=>e.id===i);return f?e.jsxs("div",{children:[e.jsx("button",{onClick:()=>m(null),className:"flex items-center gap-2 text-sm text-slate-600 hover:text-slate-900 mb-4",children:"← Back to all tools"}),f.component]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-800",children:"Tools"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b.map(s=>e.jsxs(t,{onClick:()=>m(s.id),className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all",children:[e.jsx("div",{className:"text-3xl mb-2",children:s.icon}),e.jsx("h3",{className:"font-bold text-lg",children:s.name}),e.jsx("p",{className:"text-sm text-slate-600",children:s.description})]},s.id))})]})};export{N as ToolsView};
